function Canvas(c){this.isDom=function(f){try{return f instanceof HTMLElement}catch(d){return(typeof f==="object")&&(f.nodeType===1)&&(typeof f.style==="object")&&(typeof f.ownerDocument==="object")}};var b=undefined!=c&&this.isDom(c)?c:document.body;var a=b.getElementsByTagName("canvas");if(a.length==0){a=b.appendChild(document.createElement("canvas"));a.width=b.clientWidth;a.height=b.clientHeight}else{a=a[0]}this.bounds=a.getBoundingClientRect();this.width=a.width;this.height=a.height;this._ctx=a.getContext("2d");this.drawables=[];this.addDrawable=function(d){if(d instanceof Drawable){this.drawables.push(d)}};this.delDrawable=function(e){if(e instanceof Drawable&&this.drawables.length){for(var d=this.drawables.length-1;d>=0;d--){if(this.drawables[d]==e){this.drawables.splice(d,1);return true}}}return false};this.draw=function(){if(this.drawables.length){this._ctx.clearRect(0,0,this.width,this.height);for(var d=0,e=this.drawables.length;d<e;d++){this.drawables[d].draw(this._ctx)}}};this.clear=function(){this.drawables=[];this._ctx.clearRect(0,0,this.width,this.height)};this._onClick=function(f){var e=f.clientX-this.bounds.left,h=f.clientY-this.bounds.top;for(var d in this.drawables){var g=this.drawables[d];if(g.vision(e,h)&&typeof g.onClick==="function"){g.onClick(e,h);g.draw(this._ctx)}}};a.addEventListener("mouseup",this._onClick.bind(this),false);a.addEventListener("touchend",this._onClick.bind(this),false)}var Drawable=function(){this.x=0;this.y=0;this.w=0;this.h=0;this.label=false;this.fontName="Verdana";this.fontColor="#ffffff";this.fontSize=14;this.width=function(a){if(undefined==a){return this.w}else{this.w=a}return this};this.height=function(a){if(undefined==a){return this.h}else{this.h=a}return this};this.size=function(a,b){if(undefined==a){return{w:this.w,h:this.h}}else{if(a&&b){this.w=a;this.h=b}}return this};this.position=function(a,b){if(undefined==a){return{x:this.x,y:this.y}}else{if(undefined!=a&&undefined!=b){this.x=a;this.y=b}}return this};this.vision=function(o,n){var h={x:o,y:n};var g=function g(p,m){return{x:(m.x-p.x),y:(m.y-p.y)}};var d=function(p,m){return p.x*m.x+p.y*m.y};var c={A:{x:this.x,y:this.y},B:{x:this.x+this.w,y:this.y},C:{x:this.x+this.w,y:this.y+this.h},D:{x:this.x,y:this.y+this.h}};var i=g(c.A,c.B);var b=g(c.A,h);var e=g(c.B,c.C);var l=g(c.B,h);var j=d(i,b);var a=d(i,i);var f=d(e,l);var k=d(e,e);return 0<=j&&j<=a&&0<=f&&f<=k}};Drawable.draw=function(c){if(this.label){c.textBaseline="top";c.font=this.fontSize+"px "+this.fontName;c.fillStyle=this.fontColor;c.textBaseline="middle";c.textAlign="center";var b=[].concat(this.label),f=c.measureText("M").width,a=this.x+this.w/2,g=this.y+f/2,e=(b.length*f);g+=this.h/2-e/2;for(var d in b){c.fillText(b[d],a,g);g+=f}}};function Rectangle(){Drawable.call(this);this.fillStyle="#f0f0f0";this.draw=function(a){a.save();a.fillStyle=this.fillStyle;a.fillRect(this.x,this.y,this.w,this.h);Drawable.draw.call(this,a);a.restore()}}Rectangle.prototype=Object.create(Drawable.prototype);Rectangle.prototype.constructor=Rectangle;function Layout(b,a){this.maxWidth=b;this.maxHeight=a;this.colCount=7;this.padding=10;this.flowLeft=function(d){var l=Math.min(this.maxWidth,this.maxHeight),i=l/this.colCount,e=i,g=0,f=0,c=e*Math.ceil(d.length/this.colCount);while(c&&c>l){i--;e--;if(i*(this.colCount+1)<l){this.colCount++}c=e*Math.ceil(d.length/this.colCount)}for(var j in d){var k=d[j];if(k instanceof Drawable){k.size(i-this.padding,e-this.padding).position(g,f);g+=i;if(g>this.maxWidth||g+i>this.maxWidth){g=0;f+=e}}}}};